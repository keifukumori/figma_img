# Figma to HTML 自動変換システム 要件定義書

## 1. プロジェクト概要

### 1.1 目的
Figmaのデザインデータから静的HTMLコードを自動生成するシステムを構築する。
デザイナーが作成したワイヤーフレーム・レイアウトを高精度（85%以上）でHTML/CSSコードに変換し、開発工数を大幅削減する。

### 1.2 スコープ
- **対象**: 静的レイアウトの自動コーディング
- **除外**: 動的インタラクション、画面遷移、アニメーション
- **除外**: ヘッダー・フッター・サイドバー・ナビゲーション（共通部品として別途用意）

## 2. システム要件

### 2.1 入力データ
- **Figma デザインファイル**: PC版・SP版の両方
- **対象フレーム**: メインコンテンツエリアのみ
- **データ形式**: Figma API経由でのJSON取得

### 2.2 出力データ
- **HTML**: セマンティックなマークアップ
- **CSS**: レスポンシブ対応スタイルシート
- **構造**: BEM記法によるCSS命名規則

### 2.3 技術仕様
- **API**: Figma REST API v1
- **実装言語**: Python
- **処理環境**: Claude Code
- **料金**: 基本無料範囲での利用

## 3. 対応レイアウト範囲

### 3.1 高精度対応（85%以上の精度目標）

#### 基本要素
- ボタン（角丸、色、テキスト）
- テキスト（フォント、サイズ、色）
- 画像（位置、サイズ）
- 単純な背景・枠線

#### メインコンテンツレイアウト
- 記事・ブログ投稿レイアウト
- 商品一覧・カタログ表示
- ダッシュボード内のウィジェット配置
- 検索結果一覧
- プロフィール・詳細ページ

#### コンポーネント
- カード（商品カード、記事カード）
- テーブル・データ表示
- フォーム（入力フォーム、設定画面）
- タブ・アコーディオン内容
- モーダル・ポップアップ内容

#### レイアウトパターン
- 2-4カラムグリッド
- リスト＋詳細の2ペイン
- ステップ・ウィザード形式
- 画像＋テキストの組み合わせ

### 3.2 やや難しい（70%程度の精度）
- 4×3のグリッド配置
- サイドバー + メインコンテンツ
- ヘッダー・フッター構造
- テキストの回り込み

### 3.3 除外対象
- カスタムイラスト・アイコン
- 複雑なアニメーション指定
- 細かいマイクロインタラクション
- ブランド固有のデザインパターン
- 不規則な要素配置

## 4. 処理制約と対応方針

### 4.1 コンテキスト制約
- **Claude処理制限**: 約200,000トークン（約150,000文字相当）
- **一括処理可能**: 中規模ページ（要素数100個程度）
- **分割処理必要**: 大規模ページ（1万ピクセル超）

### 4.2 分割処理戦略
```
1万ピクセル級ページの場合:
PC版: 約8,000px, 200-400要素
SP版: 15,000-20,000px, 300-600要素

→ セクション単位での段階的処理
```

## 5. 技術アーキテクチャ

### 5.1 処理フロー

#### Phase 1: 構造解析（軽量処理）
```
目的: ラッパー・セクション構造の把握
対象: 全セクション（10セクション程度）
取得データ: 基本レイアウト情報のみ
容量: 約50KB
```

#### Phase 2: 詳細解析（重量処理）
```
目的: 個別セクションの詳細HTML生成
対象: 1セクションずつ処理
取得データ: 完全なスタイル・要素情報
容量: 約40KB/セクション
```

### 5.2 セクション自動検出

#### 優先順位
1. **Figmaフレーム構造**（85%精度）
2. **レイヤー命名規則**（70%精度）
3. **Y座標 + 要素密度**（60%精度）
4. **デフォルト分割**（画面単位等）

#### 検出ロジック
```python
# レイヤー命名パターン例
"Hero Section"
"Feature List" 
"Pricing Table"
"Contact Form"

# フレーム構造例
Frame > Hero
Frame > Features  
Frame > Pricing
```

### 5.3 ラッパー・コンテナ判定

#### 判定方法
```python
# 複数セクションで共通する幅を検出
共通幅検出: 10セクション分析 → 統計的判定（95%精度）
フォールバック: 3-5セクション分析 → 基本判定（80%精度）

# 判定例
sections = [
  {"width": 1200, "frequency": 7},  # 70% → ラッパー幅
  {"width": 800, "frequency": 2},   # 20% → 内部要素
  {"width": 400, "frequency": 1}    # 10% → 部分要素
]
```

### 5.4 レスポンシブ判定

#### PC・SP版比較による自動判定
```
PC版: 横4列配置 → SP版: 縦1列配置
→ CSS Grid with auto-fit

PC版: 横並びメニュー → SP版: ハンバーガーメニュー  
→ display: none/block 切り替え

判定精度: 60% → 85%に向上
```

### 5.5 階層構造管理

#### 要素の紐付けシステム
```json
{
  "wrapper": {
    "id": "1:200",
    "width": 1200,
    "role": "wrapper"
  },
  "inner": {
    "id": "1:201", 
    "width": 1000,
    "role": "inner"
  },
  "contents": [
    {"id": "1:202", "role": "content", "type": "3-column-grid"},
    {"id": "1:203", "role": "content", "type": "image-gallery"}
  ]
}
```

#### 整合性チェック
```python
# 幅の整合性
total_content_width <= inner_width

# 相対位置の正規化
content.relative_x = content.absolute_x - inner.absolute_x
```

## 6. 実装計画

### 6.1 既存システム拡張
```
基盤: 現在の fetch_figma_images.py
拡張内容:
- 画像取得 → レイアウトデータ取得
- JSON解析 → セクション自動検出  
- HTML生成機能追加
```

### 6.2 新機能開発

#### 6.2.1 データ取得拡張
```python
# 現在: 画像のみ
fetch_figma_images.py

# 拡張後: レイアウト情報
fetch_figma_layout.py
├── セクション検出
├── ラッパー判定
├── PC/SP比較
└── HTML生成
```

#### 6.2.2 出力形式
```
出力ディレクトリ構造:
figma_output/
├── [プロジェクト名]/
│   ├── [フレーム名]/
│   │   ├── index.html
│   │   ├── style.css
│   │   ├── images/
│   │   └── sections/
│   │       ├── section1.html
│   │       ├── section2.html
│   │       └── ...
```

### 6.3 HTML生成仕様

#### セマンティックHTML
```html
<div class="container" style="max-width: 1200px; margin: 0 auto;">
  <section class="hero-section">
    <div class="inner" style="max-width: 1000px; margin: 0 auto;">
      <div class="grid-3-columns">
        <div class="column">...</div>
        <div class="column">...</div>
        <div class="column">...</div>
      </div>
    </div>
  </section>
</div>
```

#### CSS生成
```css
/* レスポンシブ対応 */
@media (max-width: 768px) {
  .grid-3-columns {
    grid-template-columns: 1fr;
  }
}

/* BEM記法 */
.hero-section__title { }
.hero-section__content { }
.hero-section__button { }
```

## 7. 成功指標

### 7.1 精度目標
- **ワイヤーフレーム要素**: 85%以上の精度
- **基本レイアウト**: 90%以上の精度
- **レスポンシブ対応**: 80%以上の精度

### 7.2 効率化目標
- **HTML実装工数**: 70%削減
- **初期レイアウト作成**: 90%削減
- **レスポンシブ実装**: 60%削減

### 7.3 品質目標
- **セマンティックHTML**: 適切なタグ使用
- **アクセシビリティ**: 基本対応
- **保守性**: BEM記法、コメント付与

## 8. リスク・制約事項

### 8.1 技術的制約
- Figma API制限: 1000回/時間
- Claude処理制限: 大規模ページは分割必須
- 推測ベース処理: 100%の精度は困難

### 8.2 デザイン依存性
- Figmaレイヤー構造の品質に依存
- 命名規則の統一が前提
- Auto Layout使用推奨

### 8.3 保守・運用
- Figma APIの仕様変更リスク
- デザインパターンの学習・更新必要
- 複雑なレイアウトは手動調整必須

## 9. 今後の拡張可能性

### 9.1 短期拡張
- コンポーネントライブラリ対応
- CSS Framework（Bootstrap、Tailwind）出力
- 画像最適化・圧縮

### 9.2 中期拡張
- JavaScript生成（基本的なインタラクション）
- CMS連携（WordPress、Contentful）
- デザインシステム自動生成

### 9.3 長期拡張
- AI学習による精度向上
- リアルタイムプレビュー
- チーム開発ワークフロー統合